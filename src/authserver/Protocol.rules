--- #YAML:1.0
# Authenticaton and realm list protocol opcodes client 3.0.2 build 9056
# This is a YAML File: http://yaml4r.sourceforge.net/cookbook/
-
    name: header_start
    type: c++code
    code: |
        #ifndef __REALMPROTO_H__
        #define __REALMPROTO_H__

        #include "RealmListSrv.h"

-
    name: header_end
    type: c++code
    code: |
        #endif // __REALMPROTO_H__

-
    name: opcodes_start
    type: c++code
    code: |
        enum RealmOpcodes
        {

-
    name: opcodes_end
    type: c++code
    code: |
        };

-
    name: code_start
    type: c++code
    code: |
        #include "Opcodes.h"


-
    name: code_end
    type: c++code
    code: |
        // --- THE END ---

-
    name: pkthdr_size
    type: c++code
    code: sizeof (uint8)

-
    name: pkthdr_assemble
    type: c++code
    code: |
        *cur++ = %(name)s;

# Uncomment this to see unhandled packet types
-
    name: parser_default
    type: c++code
    code: |
        CONSOLE.TextOutput ("\axeWARNING: \ax6Unhandled packet %(name)s\n");

########################################################################
#                          Realm List errors                           #
########################################################################
-
    name: ASE_SUCCESS
    type: const
    value: 0
    enum: AuthServerResults
    info: Authentication successful.
-
    name: ASE_FAILURE
    type: const
    value: 1
    enum: AuthServerResults
    info: Unable to connect.
-
    name: ASE_UNKNOWN1
    type: const
    value: 2
    enum: AuthServerResults
    info: Unable to connect.
-
    name: ASE_ACCOUNT_CLOSED
    type: const
    value: 3
    enum: AuthServerResults
    info: This <game> account has been closed and is no longer available for use. Please go to <site>/banned.html for further information.
-
    name: ASE_BAD_CREDENTIALS
    type: const
    value: 4
    enum: AuthServerResults
    info: The information you have entered is not valid. Please check the spelling of the account name and password. If you need help in retrieving a lost or stolen password, see <site> for more information.
-
    name: ASE_BAD_CREDENTIALS_DUP
    type: const
    value: 5
    enum: AuthServerResults
    info: The information you have entered is not valid. Please check the spelling of the account name and password. If you need help in retrieving a lost or stolen password, see <site> for more information.
-
    name: ASE_ALREADY_LOGGED_IN
    type: const
    value: 6
    enum: AuthServerResults
    info: This account is already logged into <game>. Please check the spelling and try again.
-
    name: ASE_PREPAID_TIME_EXPIRED
    type: const
    value: 7
    enum: AuthServerResults
    info: You have used up your prepaid time for this account. Please purchase more to continue playing.
-
    name: ASE_CANNOT_LOGIN
    type: const
    value: 8
    enum: AuthServerResults
    info: Could not log in to <game> at this time. Please try again later.
-
    name: ASE_BAD_VERSION
    type: const
    value: 9
    enum: AuthServerResults
    info: Unable to validate game version. This may be caused by file corruption or interference of another program. Please visit <site> for more information and possible solutions to this issue.
-
    name: ASE_UPDATE_CLIENT
    type: const
    value: 10
    enum: AuthServerResults
    info: Downloading.
-
    name: ASE_UNKNOWN3
    type: const
    value: 11
    enum: AuthServerResults
    info: Unable to connect.
-
    name: ASE_ACCOUNT_FROZEN
    type: const
    value: 12
    enum: AuthServerResults
    info: This <game> account has been temporarily suspended. Please go to <site>/banned.html for further information.
-
    name: ASE_UNKNOWN4
    type: const
    value: 13
    enum: AuthServerResults
    info: Unable to connect.
-
    name: ASE_UNKNOWN5
    type: const
    value: 14
    enum: AuthServerResults
    info: Connected.
-
    name: ASE_PARENTAL_CONTROL
    type: const
    value: 15
    enum: AuthServerResults
    info: Access to this account has been blocked by parental controls. Your settings may be changed in your account preferences at <site>.

########################################################################
#                            Packet opcodes                            #
########################################################################

-
    name: CMSG_LOGON_CHALLENGE
    opcode: 0x00
    type: packet
    direction: in
    c++handler: HandleLogonChallenge
    structure:
      - ErrorCode:
            type: uint8
      - Length:
            type: uint16
            info: 0x0026
      - GameID:
            type: uint8
            array: 4
            info: "WoW\0" (WoW backwards :-)
      - ClientVersion:
            type: uint8
            array: 3
            info: like 1, 2, 4 or 1, 3, 0 etc
      - ClientBuild:
            type: uint16
            info: like 4150, 4284 etc
      - Arch:
            type: uint8
            array: 4
            info: "68x\0" (x86 backwards)
      - OS:
            type: uint8
            array: 4
            info: "niW\0" (Win backwards)
      - Lang:
            type: uint8
            array: 4
            info: "BGne" (enGB backwards)
      - TimeZone:
            type: uint32
            info: 180 (in my case GMT+3)
      - ClientIP:
            type: uint32
            info: User's real IP address in network byte order
      - UserName:
            type: pstring

-
    name: SMSG_LOGON_CHALLENGE
    opcode: 0x00
    type: packet
    direction: out
    structure:
      - ErrorCode:
            type: uint8
            const: ASE_SUCCESS
      - unknown2:
            type: uint8
            const: 0
      - BR:
            type: uint8
            array: 32
      - g_len:
            type: uint8
            const: 1
      - g:
            type: uint8
            const: 7
      - N_len:
            type: uint8
            const: 32
      - N:
            type: uint8
            array: 32
      - Salt:
            type: uint8
            array: 32
      - unknown3:
            type: uint8
            array: 16
            const: 0

-
    name: CMSG_LOGON_PROOF
    opcode: 0x01
    type: packet
    direction: in
    c++handler: HandleLogonProof
    structure:
      - A:
            type: uint8
            array: 32
      - M1:
            type: uint8
            array: 20
      - CRC:
            type: uint8
            array: 20
      - NumKeys:
            type: uint8

-
    name: SMSG_LOGON_PROOF
    opcode: 0x01
    type: packet
    direction: out
    structure:
      - ErrorCode:
            type: uint8
            init: ASE_SUCCESS
      - if ErrorCode == ASE_SUCCESS:
          - M2:
                type: uint8
                array: 20
          - unknown2:
                type: uint32
                const: 0

-
    name: CMSG_RECONNECT_CHALLENGE
    opcode: 0x02
    type: packet
    direction: in
    c++handler: HandleReconnectChallenge
    structure:
      - ErrorCode:
            type: uint8
      - Length:
            type: uint16
            info: 0x0026
      - GameID:
            type: uint8
            array: 4
            info: "WoW\0" (WoW backwards :-)
      - ClientVersion:
            type: uint8
            array: 3
            info: like 1, 2, 4 or 1, 3, 0 etc
      - ClientBuild:
            type: uint16
            info: like 4150, 4284 etc
      - Arch:
            type: uint8
            array: 4
            info: "68x\0" (x86 backwards)
      - OS:
            type: uint8
            array: 4
            info: "niW\0" (Win backwards)
      - Lang:
            type: uint8
            array: 4
            info: "BGne" (enGB backwards)
      - TimeZone:
            type: uint32
            info: 180 (in my case GMT+3)
      - ClientIP:
            type: uint32
            info: User's real IP address in network byte order
      - UserName:
            type: pstring

-
    name: CMSG_RECONNECT_PROOF
    opcode: 0x03
    type: packet
    direction: in

-
    name: CMSG_REALMLIST
    opcode: 0x10
    type: packet
    direction: in
    c++handler: HandleRealmList
    structure:
      - request:
            type: uint32

-
    name: SMSG_REALMLIST
    opcode: 0x10
    type: packet
    direction: out
    structure:
      - DataLen:
            type: uint16
      - Request:
            type: uint32
      - NumRealms:
            type: uint8
      - RealmList:
            type: vector
            vtype: RealmVector
            counter: NumRealms
            structure:
              - Type:
                    type: uint32
              - Color:
                    type: uint8
              - Name:
                    type: string
              - Address:
                    type: string
              - Population:
                    type: float
              - NumChars:
                    type: uint8
              - Language:
                    type: uint8
              - unknown:
                    type: uint8
                    const: 1
      - unknown1:
            type: uint8
            const: 0
      - unknown2:
            type: uint8
            const: 2
